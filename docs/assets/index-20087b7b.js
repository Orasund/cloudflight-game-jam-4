var P=Object.defineProperty;var T=(t,e,i)=>e in t?P(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var d=(t,e,i)=>(T(t,typeof e!="symbol"?e+"":e,i),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function i(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(c){if(c.ep)return;c.ep=!0;const r=i(c);fetch(c.href,r)}})();const W=400,C=700,k=50,n={canvasWidth:C,canvasHeight:W,paddleHeight:10,paddleWidth:75,ballRadius:20,brickRowCount:Math.floor(C/k),brickColumnCount:Math.floor(W/k),brickWidth:k,brickHeight:k,brickPadding:0,brickOffsetTop:0,brickOffsetLeft:0,chickensPerCell:5,levelResolution:1,maxPlacedObsticales:5,ballSpeed:1.5,brickRejectForce:4};var h=(t=>(t.Snake="snake",t.Brick1="brick1",t.Brick2="brick2",t.Brick3="brick3",t.BrickInvisible="invisble_brick",t.RoundChicken="roundChicken",t.Lava="lava",t.Chair="chair",t))(h||{});class V{constructor(){d(this,"pool",new Map);d(this,"amountLoaded",0);Object.values(h).map(e=>this.pool.set(e,this.newImage(e)))}get(e){return this.pool.get(e)}isLoading(){return this.amountLoaded<this.pool.size}newImage(e){const i=new Image;return i.src="assets/images/"+e+".png",i.onload=()=>this.amountLoaded++,i}}class D{constructor(e){d(this,"imagePool",new V);d(this,"ctx");this.ctx=e}image(e){const[i,s]=e.center;return this.ctx.drawImage(this.imagePool.get(e.source),i-e.width/2,s-e.height/2,e.width,e.height),this}circle(e){const[i,s]=e.center;return this.ctx.beginPath(),this.ctx.arc(i,s,e.radius,0,Math.PI*2),this.ctx.fillStyle=e.color,this.ctx.fill(),this.ctx.closePath(),this}rect(e){const[i,s]=e.center;return this.ctx.beginPath(),this.ctx.rect(i-e.width/2,s-e.height/2,e.width,e.height),this.ctx.fillStyle=e.color,this.ctx.fill(),this.ctx.closePath(),this}text(e,i){return this.textWithArgs({pos:i,value:e})}title(e,i){return this.textWithArgs({pos:i,value:e,size:64,center:!0})}textWithArgs(e){const[i,s]=e.pos,c=e.font??"Arial",r=e.size??16,o=e.color??"#000000",a=e.center??!1;return this.ctx.font=r+"px "+c,this.ctx.fillStyle=o,a&&(this.ctx.textAlign="center"),this.ctx.fillText(e.value,i,s),a&&(this.ctx.textAlign="left"),this}}function K(t,e){for(var i=0;i<n.brickColumnCount;i++)for(var s=0;s<n.brickRowCount;s++){let c=h.BrickInvisible;t.bricks[i][s].isVisible==!0&&(c=h.Brick1),t.bricks[i][s].cellType=="goal"&&(c=h.Brick2),t.bricks[i][s].cellType=="lava"&&(c=h.Lava),t.bricks[i][s].cellType=="chair"&&t.bricks[i][s].isVisible==!0&&(c=h.Chair),e.image({source:c,center:[t.bricks[i][s].x+n.brickWidth/2,t.bricks[i][s].y+n.brickHeight/2],width:n.brickWidth,height:n.brickHeight})}}function M(t,e){e.clearRect(0,0,n.canvasWidth,n.canvasHeight);const i=new D(e);switch(t.end){case"won":i.title("Game Won",[n.canvasWidth/2,n.canvasHeight/2]),i.textWithArgs({value:"Click to Continue",pos:[n.canvasWidth/2,n.canvasHeight/2+50],center:!0});return;case"lost":i.title("Game Lost",[n.canvasWidth/2,n.canvasHeight/2]),i.textWithArgs({value:"Click to Continue",pos:[n.canvasWidth/2,n.canvasHeight/2+50],center:!0});return;case"finished":i.title("Thanks for playing",[n.canvasWidth/2,n.canvasHeight/2]);return}K(t,i),t.placed.length===0&&i.textWithArgs({value:"Click to place",pos:[n.canvasWidth/2,n.canvasHeight-75],size:24,center:!0}),t.snakes.forEach(s=>{s.isVisible&&i.image({source:h.Snake,center:[s.x,s.y],width:n.ballRadius*2,height:n.ballRadius*2})}),t.balls.forEach(s=>{s.isVisible&&i.image({source:h.RoundChicken,center:[s.x,s.y],width:n.ballRadius*2,height:n.ballRadius*2})})}class O{constructor(){d(this,"pressed");d(this,"mousePos");d(this,"mouseDown");d(this,"clicked");this.pressed=new Set,this.mousePos=[0,0],this.mouseDown=!1,this.clicked=!1}mouseInArea(e){const[i,s]=this.mousePos,[c,r]=e.center,o=c-e.width/2,a=r-e.height/2,b=c+e.width/2,p=r+e.height/2;return o<=i&&i<=b&&a<=s&&s<=p}keyDownHandler(e){console.log(e.code),e.code=="ArrowRight"||e.code=="KeyD"?this.pressed.add("Right"):e.code=="ArrowLeft"||e.code=="KeyA"?this.pressed.add("Left"):e.code=="ArrowUp"||e.code=="KeyW"?this.pressed.add("Up"):(e.code=="ArrowDown"||e.code=="KeyS")&&this.pressed.add("Down")}keyUpHandler(e){e.code=="ArrowRight"||e.code=="KeyD"?this.pressed.delete("Right"):e.code=="ArrowLeft"||e.code=="KeyA"?this.pressed.delete("Left"):e.code=="ArrowUp"||e.code=="KeyW"?this.pressed.delete("Up"):(e.code=="ArrowDown"||e.code=="KeyS")&&this.pressed.delete("Down")}mouseMoveHandler(e){return i=>{var s=i.clientX-e.offsetLeft,c=i.clientY-e.offsetTop;s>0&&s<e.width&&c>0&&c<e.height&&(this.mousePos=[s,c])}}touchMoveHandler(e){return i=>{var s=i.touches[0].clientX-e.offsetLeft,c=i.touches[0].clientY-e.offsetTop;s>0&&s<e.width&&c>0&&c<e.height&&(this.mousePos=[s,c])}}}function E(t){switch(t){case 1:return B;case 2:return Y;case 3:return X}return null}const B=["🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱","🧱🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🧱","🏁🔲🔲🔲🔲🔲🧱🔲🔲🔲🐤🔲🔲🧱","🏁🔲🔲🔲🔲🔲🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🧱","🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱"],X=["🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🌋🌋🧱","🧱🔲🔲🔲🔲🔲🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🧱🔲🔲🔲🔲🔲🔲🧱","🏁🔲🔲🔲🔲🔲🧱🔲🔲🔲🔲🔲🔲🧱","🏁🔲🔲🔲🔲🔲🔲🔲🔲🔲🧱🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🔲🔲🔲🧱🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🔲🔲🔲🧱🔲🐤🧱","🧱🌋🌋🌋🌋🌋🧱🧱🧱🧱🧱🧱🧱🧱"],Y=["🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱","🧱🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🧱","🧱🧱🧱🧱🔲🔲🧱🔲🔲🔲🔲🔲🔲🧱","🏁🔲🔲🔲🔲🔲🧱🔲🔲🔲🐤🔲🔲🧱","🏁🔲🔲🔲🔲🔲🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🧱","🧱🐍🐍🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🧱","🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱"];function S(t,e,i){const[s,c]=e;switch(t){case"🌋":i.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!0,lastClicKTick:0,cellType:"lava"};return;case"🐍":i.snakes.push(F([s*n.brickWidth,c*n.brickHeight]));return;case"🐤":for(var r=0;r<n.chickensPerCell;r++)i.balls.push(U([s*n.brickWidth,c*n.brickHeight]));i.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!1,lastClicKTick:0,cellType:"chair"};return;case"🧱":i.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!0,lastClicKTick:0,cellType:"obstacle"};return;case"🏁":i.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!0,lastClicKTick:0,cellType:"goal"};return;default:i.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!1,lastClicKTick:0,cellType:"chair"};return}}function z(t,e){const i=E(t);return i?i.map(s=>Array.from(s).flatMap(c=>Array(n.levelResolution).fill(c))).flatMap(s=>Array(n.levelResolution).fill(s)).forEach((s,c)=>{s.forEach((r,o)=>{S(r,[o,c],e)})}):e.end="finished",e}function f(t){const[e,i]=t,s=v(t);return[e/s,i/s]}function v(t){const[e,i]=t;return Math.sqrt(e*e+i*i)}function H(t,e){const[i,s]=t;return[i+(Math.random()*2-1)*e,s+(Math.random()*2-1)*e]}function w(t,e){const[i,s]=t;return[i*e,s*e]}function m(t,e){const[i,s]=t,[c,r]=e;return[i+c,s+r]}function R(t,e){const[i,s]=t,[c,r]=e.pos;return i>c-e.width/2&&i<c+e.width/2&&s>r-e.height/2&&s<r+e.height/2}function x(t){const e={paddle:{x:(n.canvasWidth-n.paddleWidth)/2},bricks:_(),score:0,lives:3,balls:[],snakes:[],end:void 0,currentTick:0,placed:[],level:t};return z(t,e)}function _(){let t=[];for(var e=0;e<n.brickColumnCount;e++){t[e]=[];for(var i=0;i<n.brickRowCount;i++){var s=i*(n.brickWidth+n.brickPadding)+n.brickOffsetLeft,c=e*(n.brickHeight+n.brickPadding)+n.brickOffsetTop;let r="obstacle";e==0&&i<5&&(r="goal"),t[e][i]={x:s,y:c,isVisible:!1,lastClicKTick:0,cellType:r}}}return t}function U(t){const[e,i]=t,[s,c]=w(f(H([0,0],1)),n.ballSpeed);return{dx:s,dy:c,x:e,y:i,isVisible:!0}}function F(t){const[e,i]=t,[s,c]=f([2+Math.random(),-2+Math.random()]);return{dx:s,dy:c,x:e,y:i,isVisible:!0}}function I(t){return t.balls.filter(e=>e.isVisible).length==0}function A(t,e,i){for(var s=0;s<n.brickColumnCount;s++)for(var c=0;c<n.brickRowCount;c++){var r=t.bricks[s][c];if(e.x>r.x-n.ballRadius&&e.x<r.x+n.brickWidth+n.ballRadius&&e.y>r.y-n.ballRadius&&e.y<r.y+n.brickHeight+n.ballRadius&&(r.cellType=="goal"&&!i&&(e.isVisible=!1),r.cellType=="lava"&&!i&&(t.end="lost"),r.isVisible==!0)){const o=r.x+n.brickWidth/2,a=r.y+n.brickHeight/2,[b,p]=H(w(f(m(j([o,a],t),f([e.x-o,e.y-a]))),n.ballSpeed),.1);e.dx=b,e.dy=p}}}function q(t,e){t.snakes.forEach(i=>{if(!i.isVisible)return;const s=[e.x-i.x,e.y-i.y];v(s)<2*n.ballRadius&&(t.end="lost")})}function G(t){t.balls.forEach(e=>{e.isVisible&&(L(e),A(t,e,!1),q(t,e))})}function L(t){(t.x+t.dx>n.canvasWidth-n.ballRadius||t.x+t.dx<n.ballRadius)&&(t.dx=-t.dx),(t.y+t.dy>n.canvasHeight-n.ballRadius||t.y+t.dy<n.ballRadius)&&(t.dy=-t.dy),t.x+=t.dx,t.y+=t.dy}function j(t,e){const[i,s]=t;return e.placed.map(c=>{const r=e.bricks[c.y][c.x],o=[i-r.x,s-r.y];return w(f(o),n.brickRejectForce/v(o))}).reduce(m,[0,0])}function N(t,e){t.pressed.size==0?e.paddle.x=t.mousePos[0]-n.paddleWidth/2:t.pressed.has("Right")&&e.paddle.x<n.canvasWidth-n.paddleWidth?e.paddle.x+=7:t.pressed.has("Left")&&e.paddle.x>0&&(e.paddle.x-=7)}function J(t){t.snakes.forEach(e=>{e.isVisible&&(L(e),A(t,e,!0))})}function Q(t,e){for(var i=0;i<n.brickColumnCount;i++)for(var s=0;s<n.brickRowCount;s++){if(t.bricks[i][s].isVisible)continue;const c=t.bricks[i][s].x+n.brickWidth/2,r=t.bricks[i][s].y+n.brickHeight/2;if(e.mouseInArea({center:[c,r],width:n.brickWidth,height:n.brickHeight})&&Z([c,r],n.brickWidth,n.brickHeight,t)&&e.mouseDown&&(t.bricks[i][s].isVisible=!0,t.placed.push({y:i,x:s}),t.placed.length>n.maxPlacedObsticales)){const o=t.placed.shift();t.bricks[o.y][o.x].isVisible=!1}}}function Z(t,e,i,s){return s.balls.filter(c=>R([c.x,c.y],{pos:t,width:e+n.ballRadius*2,height:i+n.ballRadius*2})).length==0&&s.snakes.filter(c=>R([c.x,c.y],{pos:t,width:e+n.ballRadius*2,height:i+n.ballRadius*2})).length==0}function $(t,e){return e.end?(e.end==="lost"&&t.mouseDown?(console.log("lost"),e=x(e.level)):e.end==="won"&&t.mouseDown&&(console.log("won"),e=x(e.level+1)),e):(e.currentTick++,N(t,e),G(e),J(e),Q(e,t),I(e)&&(e.end="won"),e)}const ee=document.querySelector("#app"),u=document.createElement("canvas");u.width=n.canvasWidth;u.height=n.canvasHeight;ee.append(u);let y=x(1),l=new O;document.addEventListener("keydown",te,!1);document.addEventListener("keyup",ie,!1);document.addEventListener("mousemove",l.mouseMoveHandler(u),!1);document.addEventListener("mousedown",()=>l.mouseDown=!0);document.addEventListener("mouseup",()=>l.mouseDown=!1);document.addEventListener("click",()=>l.clicked=!0);u.ontouchmove=l.touchMoveHandler(u);u.ontouchstart=()=>l.mouseDown=!0;u.ontouchend=()=>l.mouseDown=!1;function te(t){l.keyDownHandler(t)}function ie(t){l.keyUpHandler(t)}const se=u.getContext("2d");function g(){y=$(l,y),M(y,se),l.clicked=!1,requestAnimationFrame(g)}g();
