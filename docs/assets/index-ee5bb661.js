var A=Object.defineProperty;var V=(t,e,i)=>e in t?A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var d=(t,e,i)=>(V(t,typeof e!="symbol"?e+"":e,i),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const o of c)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function i(c){const o={};return c.integrity&&(o.integrity=c.integrity),c.referrerPolicy&&(o.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?o.credentials="include":c.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(c){if(c.ep)return;c.ep=!0;const o=i(c);fetch(c.href,o)}})();const m=400,W=700,k=25,n={canvasWidth:W,canvasHeight:m,paddleHeight:10,paddleWidth:75,ballRadius:10,brickRowCount:Math.floor(W/k),brickColumnCount:Math.floor(m/k),brickWidth:k,brickHeight:k,brickPadding:0,brickOffsetTop:0,brickOffsetLeft:0,chickensPerCell:5,levelResolution:2,maxPlacedObsticales:20,ballSpeed:1.5,brickRejectForce:4};var l=(t=>(t.Snake="snake",t.Brick1="brick1",t.Brick2="brick2",t.Brick3="brick3",t.BrickInvisible="invisble_brick",t.RoundChicken="roundChicken",t.Lava="lava",t))(l||{});class T{constructor(){d(this,"pool",new Map);d(this,"amountLoaded",0);Object.values(l).map(e=>this.pool.set(e,this.newImage(e)))}get(e){return this.pool.get(e)}isLoading(){return this.amountLoaded<this.pool.size}newImage(e){const i=new Image;return i.src="assets/images/"+e+".png",i.onload=()=>this.amountLoaded++,i}}class D{constructor(e){d(this,"imagePool",new T);d(this,"ctx");this.ctx=e}image(e){const[i,s]=e.center;return this.ctx.drawImage(this.imagePool.get(e.source),i-e.width/2,s-e.height/2,e.width,e.height),this}circle(e){const[i,s]=e.center;return this.ctx.beginPath(),this.ctx.arc(i,s,e.radius,0,Math.PI*2),this.ctx.fillStyle=e.color,this.ctx.fill(),this.ctx.closePath(),this}rect(e){const[i,s]=e.center;return this.ctx.beginPath(),this.ctx.rect(i-e.width/2,s-e.height/2,e.width,e.height),this.ctx.fillStyle=e.color,this.ctx.fill(),this.ctx.closePath(),this}text(e,i){return this.textWithArgs({pos:i,value:e})}title(e,i){return this.textWithArgs({pos:i,value:e,size:64})}textWithArgs(e){const[i,s]=e.pos,c=e.font?e.font:"Arial",o=e.size?e.size:16,r=e.color?e.color:"#0095DD";return this.ctx.font=o+"px "+c,this.ctx.fillStyle=r,this.ctx.fillText(e.value,i,s),this}}function K(t,e){for(var i=0;i<n.brickColumnCount;i++)for(var s=0;s<n.brickRowCount;s++){let c=l.BrickInvisible;t.bricks[i][s].isVisible==!0&&(c=l.Brick1),t.bricks[i][s].cellType=="goal"&&(c=l.Brick2),t.bricks[i][s].cellType=="lava"&&(c=l.Lava),e.image({source:c,center:[t.bricks[i][s].x+n.brickWidth/2,t.bricks[i][s].y+n.brickHeight/2],width:n.brickWidth,height:n.brickHeight})}}function O(t,e){e.clearRect(0,0,n.canvasWidth,n.canvasHeight);const i=new D(e);switch(t.end){case"won":i.title("Game Won",[n.canvasWidth/2-150,n.canvasHeight/2]);return;case"lost":i.title("Game Lost",[n.canvasWidth/2-150,n.canvasHeight/2]);return;case"finished":i.title("Thanks for playing",[n.canvasWidth/2-150,n.canvasHeight/2]);return}K(t,i),t.snakes.forEach(s=>{s.isVisible&&i.image({source:l.Snake,center:[s.x,s.y],width:n.ballRadius*2,height:n.ballRadius*2})}),t.balls.forEach(s=>{s.isVisible&&i.image({source:l.RoundChicken,center:[s.x,s.y],width:n.ballRadius*2,height:n.ballRadius*2})})}class E{constructor(){d(this,"pressed");d(this,"mousePos");d(this,"mouseDown");d(this,"clicked");this.pressed=new Set,this.mousePos=[0,0],this.mouseDown=!1,this.clicked=!1}mouseInArea(e){const[i,s]=this.mousePos,[c,o]=e.center,r=c-e.width/2,f=o-e.height/2,y=c+e.width/2,p=o+e.height/2;return r<=i&&i<=y&&f<=s&&s<=p}keyDownHandler(e){console.log(e.code),e.code=="ArrowRight"||e.code=="KeyD"?this.pressed.add("Right"):e.code=="ArrowLeft"||e.code=="KeyA"?this.pressed.add("Left"):e.code=="ArrowUp"||e.code=="KeyW"?this.pressed.add("Up"):(e.code=="ArrowDown"||e.code=="KeyS")&&this.pressed.add("Down")}keyUpHandler(e){e.code=="ArrowRight"||e.code=="KeyD"?this.pressed.delete("Right"):e.code=="ArrowLeft"||e.code=="KeyA"?this.pressed.delete("Left"):e.code=="ArrowUp"||e.code=="KeyW"?this.pressed.delete("Up"):(e.code=="ArrowDown"||e.code=="KeyS")&&this.pressed.delete("Down")}mouseMoveHandler(e){return i=>{var s=i.clientX-e.offsetLeft,c=i.clientY-e.offsetTop;s>0&&s<e.width&&c>0&&c<e.height&&(this.mousePos=[s,c]),s>0&&s<e.width}}}function M(t){switch(t){case 1:return g}return null}const g=["🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱","🧱🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🧱","🧱🧱🧱🧱🔲🔲🧱🔲🔲🔲🔲🔲🔲🧱","🏁🔲🔲🔲🔲🔲🧱🔲🔲🔲🐤🔲🔲🧱","🏁🔲🔲🔲🔲🔲🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🐍🔲🔲🔲🔲🔲🔲🔲🔲🔲🔲🧱","🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🧱🌋🧱"];function B(t,e,i){const[s,c]=e;switch(t){case"🌋":i.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!0,lastClicKTick:0,cellType:"lava"};return;case"🐍":i.snakes.push(U([s*n.brickWidth,c*n.brickHeight]));return;case"🐤":for(var o=0;o<n.chickensPerCell;o++)i.balls.push(_([s*n.brickWidth,c*n.brickHeight]));return;case"🧱":i.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!0,lastClicKTick:0,cellType:"obstacle"};return;case"🏁":i.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!0,lastClicKTick:0,cellType:"goal"};return;default:i.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!1,lastClicKTick:0,cellType:"obstacle"};return}}function S(t,e){const i=M(t);return i?i.map(s=>Array.from(s).flatMap(c=>Array(n.levelResolution).fill(c))).flatMap(s=>Array(n.levelResolution).fill(s)).forEach((s,c)=>{s.forEach((o,r)=>{B(o,[r,c],e)})}):e.end="finished",e}function h(t){const[e,i]=t,s=v(t);return[e/s,i/s]}function v(t){const[e,i]=t;return Math.sqrt(e*e+i*i)}function R(t,e){const[i,s]=t;return[i+(Math.random()*2-1)*e,s+(Math.random()*2-1)*e]}function w(t,e){const[i,s]=t;return[i*e,s*e]}function C(t,e){const[i,s]=t,[c,o]=e;return[i+c,s+o]}function x(t){const e={paddle:{x:(n.canvasWidth-n.paddleWidth)/2},bricks:z(),score:0,lives:3,balls:[],snakes:[],end:void 0,currentTick:0,placed:[],level:t};return S(t,e)}function z(){let t=[];for(var e=0;e<n.brickColumnCount;e++){t[e]=[];for(var i=0;i<n.brickRowCount;i++){var s=i*(n.brickWidth+n.brickPadding)+n.brickOffsetLeft,c=e*(n.brickHeight+n.brickPadding)+n.brickOffsetTop;let o="obstacle";e==0&&i<5&&(o="goal"),t[e][i]={x:s,y:c,isVisible:!1,lastClicKTick:0,cellType:o}}}return t}function _(t){const[e,i]=t,[s,c]=w(h(R([0,0],1)),n.ballSpeed);return{dx:s,dy:c,x:e,y:i,isVisible:!0}}function U(t){const[e,i]=t,[s,c]=h([2+Math.random(),-2+Math.random()]);return{dx:s,dy:c,x:e,y:i,isVisible:!0}}function X(t){return t.balls.filter(e=>e.isVisible).length==0}function H(t,e,i){for(var s=0;s<n.brickColumnCount;s++)for(var c=0;c<n.brickRowCount;c++){var o=t.bricks[s][c];if(e.x>o.x-n.ballRadius&&e.x<o.x+n.brickWidth+n.ballRadius&&e.y>o.y-n.ballRadius&&e.y<o.y+n.brickHeight+n.ballRadius&&(o.cellType=="goal"&&!i&&(e.isVisible=!1),o.cellType=="lava"&&!i&&(t.end="lost"),o.isVisible==!0)){const r=o.x+n.brickWidth/2,f=o.y+n.brickHeight/2,[y,p]=R(w(h(C(I([r,f],t),h([e.x-r,e.y-f]))),n.ballSpeed),.1);e.dx=y,e.dy=p}}}function Y(t,e){t.snakes.forEach(i=>{if(!i.isVisible)return;const s=[e.x-i.x,e.y-i.y];v(s)<2*n.ballRadius&&(t.end="lost")})}function F(t){t.balls.forEach(e=>{e.isVisible&&(L(e),H(t,e,!1),Y(t,e))})}function L(t){(t.x+t.dx>n.canvasWidth-n.ballRadius||t.x+t.dx<n.ballRadius)&&(t.dx=-t.dx),(t.y+t.dy>n.canvasHeight-n.ballRadius||t.y+t.dy<n.ballRadius)&&(t.dy=-t.dy),t.x+=t.dx,t.y+=t.dy}function I(t,e){const[i,s]=t;return e.placed.map(c=>{const o=e.bricks[c.y][c.x],r=[i-o.x,s-o.y];return w(h(r),n.brickRejectForce/v(r))}).reduce(C,[0,0])}function q(t,e){t.pressed.size==0?e.paddle.x=t.mousePos[0]-n.paddleWidth/2:t.pressed.has("Right")&&e.paddle.x<n.canvasWidth-n.paddleWidth?e.paddle.x+=7:t.pressed.has("Left")&&e.paddle.x>0&&(e.paddle.x-=7)}function G(t){t.snakes.forEach(e=>{e.isVisible&&(L(e),H(t,e,!0))})}function j(t,e){for(var i=0;i<n.brickColumnCount;i++)for(var s=0;s<n.brickRowCount;s++)if(!t.bricks[i][s].isVisible&&e.mouseInArea({center:[t.bricks[i][s].x+n.brickWidth/2,t.bricks[i][s].y+n.brickHeight/2],width:n.brickWidth,height:n.brickHeight})&&e.mouseDown&&(t.bricks[i][s].isVisible=!0,t.placed.push({y:i,x:s}),t.placed.length>n.maxPlacedObsticales)){const c=t.placed.shift();t.bricks[c.y][c.x].isVisible=!1}}function N(t,e){return e.end?(e.end==="lost"&&t.mouseDown?(console.log("lost"),e=x(e.level)):e.end==="won"&&t.mouseDown&&(console.log("won"),e=x(e.level+1)),e):(e.currentTick++,q(t,e),F(e),G(e),j(e,t),X(e)&&(e.end="won"),e)}const J=document.querySelector("#app"),a=document.createElement("canvas");a.width=n.canvasWidth;a.height=n.canvasHeight;J.append(a);let b=x(1),u=new E;document.addEventListener("keydown",Q,!1);document.addEventListener("keyup",Z,!1);document.addEventListener("mousemove",u.mouseMoveHandler(a),!1);document.addEventListener("mousedown",()=>u.mouseDown=!0);document.addEventListener("mouseup",()=>u.mouseDown=!1);document.addEventListener("click",()=>u.clicked=!0);function Q(t){u.keyDownHandler(t)}function Z(t){u.keyUpHandler(t)}const $=a.getContext("2d");function P(){b=N(u,b),O(b,$),u.clicked=!1,requestAnimationFrame(P)}P();
