var P=Object.defineProperty;var K=(i,e,t)=>e in i?P(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var l=(i,e,t)=>(K(i,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const o of c)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(c){const o={};return c.integrity&&(o.integrity=c.integrity),c.referrerPolicy&&(o.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?o.credentials="include":c.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(c){if(c.ep)return;c.ep=!0;const o=t(c);fetch(c.href,o)}})();const W=700,R=400,p=50,n={canvasWidth:R,canvasHeight:W,paddleHeight:10,paddleWidth:75,ballRadius:20,brickRowCount:Math.floor(R/p),brickColumnCount:Math.floor(W/p),brickWidth:p,brickHeight:p,brickPadding:0,brickOffsetTop:0,brickOffsetLeft:0,chickensPerCell:5,levelResolution:1,maxPlacedObsticales:5,ballSpeed:1.5,brickRejectForce:4};var a=(i=>(i.Snake="snake",i.Brick1="brick1",i.Brick2="brick2",i.Brick3="brick3",i.BrickInvisible="invisble_brick",i.RoundChicken="roundChicken",i.Lava="lava",i.Chair="chair",i))(a||{});class M{constructor(){l(this,"pool",new Map);l(this,"amountLoaded",0);Object.values(a).map(e=>this.pool.set(e,this.newImage(e)))}get(e){return this.pool.get(e)}isLoading(){return this.amountLoaded<this.pool.size}newImage(e){const t=new Image;return t.src="assets/images/"+e+".png",t.onload=()=>this.amountLoaded++,t}}class D{constructor(e){l(this,"imagePool",new M);l(this,"ctx");this.ctx=e}image(e){const[t,s]=e.center;return this.ctx.drawImage(this.imagePool.get(e.source),t-e.width/2,s-e.height/2,e.width,e.height),this}circle(e){const[t,s]=e.center;return this.ctx.beginPath(),this.ctx.arc(t,s,e.radius,0,Math.PI*2),this.ctx.fillStyle=e.color,this.ctx.fill(),this.ctx.closePath(),this}rect(e){const[t,s]=e.center;return this.ctx.beginPath(),this.ctx.rect(t-e.width/2,s-e.height/2,e.width,e.height),this.ctx.fillStyle=e.color,this.ctx.fill(),this.ctx.closePath(),this}text(e,t){return this.textWithArgs({pos:t,value:e})}title(e,t){return this.textWithArgs({pos:t,value:e,size:64,center:!0})}textWithArgs(e){const[t,s]=e.pos,c=e.font??"Arial",o=e.size??16,r=e.color??"#000000",u=e.center??!1;return this.ctx.font=o+"px "+c,this.ctx.fillStyle=r,u&&(this.ctx.textAlign="center"),this.ctx.fillText(e.value,t,s),u&&(this.ctx.textAlign="left"),this}}function O(i,e){for(var t=0;t<n.brickColumnCount;t++)for(var s=0;s<n.brickRowCount;s++){let c=a.BrickInvisible;i.bricks[t][s].isVisible==!0&&(c=a.Brick1),i.bricks[t][s].cellType=="goal"&&(c=a.Brick2),i.bricks[t][s].cellType=="lava"&&(c=a.Lava),i.bricks[t][s].cellType=="chair"&&i.bricks[t][s].isVisible==!0&&(c=a.Chair),e.image({source:c,center:[i.bricks[t][s].x+n.brickWidth/2,i.bricks[t][s].y+n.brickHeight/2],width:n.brickWidth,height:n.brickHeight})}}function E(i,e){e.clearRect(0,0,n.canvasWidth,n.canvasHeight);const t=new D(e);switch(i.end){case"won":t.title("Game Won",[n.canvasWidth/2,n.canvasHeight/2]),t.textWithArgs({value:"Click to Continue",pos:[n.canvasWidth/2,n.canvasHeight/2+50],center:!0});return;case"lost":t.title("Game Lost",[n.canvasWidth/2,n.canvasHeight/2]),t.textWithArgs({value:"Click to Continue",pos:[n.canvasWidth/2,n.canvasHeight/2+50],center:!0});return;case"finished":t.title("Thanks for playing",[n.canvasWidth/2,n.canvasHeight/2]);return}O(i,t),i.placed.length===0&&t.textWithArgs({value:"Click to place",pos:[n.canvasWidth/2,n.canvasHeight-75],size:24,center:!0}),i.snakes.forEach(s=>{s.isVisible&&t.image({source:a.Snake,center:[s.x,s.y],width:n.ballRadius*2,height:n.ballRadius*2})}),i.balls.forEach(s=>{s.isVisible&&t.image({source:a.RoundChicken,center:[s.x,s.y],width:n.ballRadius*2,height:n.ballRadius*2})})}class B{constructor(){l(this,"pressed");l(this,"mousePos");l(this,"mouseDown");l(this,"clicked");this.pressed=new Set,this.mousePos=[0,0],this.mouseDown=!1,this.clicked=!1}mouseInArea(e){const[t,s]=this.mousePos,[c,o]=e.center,r=c-e.width/2,u=o-e.height/2,k=c+e.width/2,b=o+e.height/2;return r<=t&&t<=k&&u<=s&&s<=b}keyDownHandler(e){console.log(e.code),e.code=="ArrowRight"||e.code=="KeyD"?this.pressed.add("Right"):e.code=="ArrowLeft"||e.code=="KeyA"?this.pressed.add("Left"):e.code=="ArrowUp"||e.code=="KeyW"?this.pressed.add("Up"):(e.code=="ArrowDown"||e.code=="KeyS")&&this.pressed.add("Down")}keyUpHandler(e){e.code=="ArrowRight"||e.code=="KeyD"?this.pressed.delete("Right"):e.code=="ArrowLeft"||e.code=="KeyA"?this.pressed.delete("Left"):e.code=="ArrowUp"||e.code=="KeyW"?this.pressed.delete("Up"):(e.code=="ArrowDown"||e.code=="KeyS")&&this.pressed.delete("Down")}mouseMoveHandler(e){return t=>{var s=t.clientX-e.offsetLeft,c=t.clientY-e.offsetTop;s>0&&s<e.width&&c>0&&c<e.height&&(this.mousePos=[s,c])}}touchMoveHandler(e){return t=>{var s=t.touches[0].clientX-e.offsetLeft,c=t.touches[0].clientY-e.offsetTop;s>0&&s<e.width&&c>0&&c<e.height&&(this.mousePos=[s,c])}}}function S(i){switch(i){case 1:return X;case 2:return z;case 3:return Y;case 4:return U}return null}const X=["🧱🧱🧱🔲🔲🧱🧱🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🧱🧱🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🐤🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🧱🧱🧱🧱🧱🧱🧱"],Y=["🧱🧱🧱🔲🔲🧱🧱🧱","🌋🔲🔲🔲🔲🔲🔲🧱","🌋🔲🔲🔲🔲🔲🔲🧱","🌋🔲🔲🔲🔲🔲🔲🧱","🌋🔲🔲🔲🔲🔲🔲🧱","🌋🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🧱🧱🧱🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🧱🧱🧱🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🌋","🧱🐤🔲🔲🔲🔲🔲🌋","🧱🧱🧱🧱🧱🧱🧱🧱"],z=["🧱🧱🧱🔲🔲🧱🧱🧱","🧱🔲🔲🔲🔲🧱🔲🧱","🧱🔲🐍🔲🔲🧱🔲🧱","🧱🔲🔲🔲🔲🧱🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🧱🧱🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🐤🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🧱🧱🧱🧱🧱🧱🧱"],U=["🧱🧱🧱🔲🔲🧱🧱🧱","🧱🔲🔲🔲🔲🧱🔲🧱","🧱🔲🔲🐍🐍🧱🔲🧱","🧱🔲🔲🔲🔲🧱🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🧱🧱🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🐤🔲🔲🧱","🧱🧱🔲🔲🔲🔲🔲🧱","🧱🔲🧱🔲🔲🔲🔲🧱","🧱🐍🔲🔲🧱🔲🔲🧱","🧱🧱🧱🧱🧱🧱🧱🧱"];function _(i,e,t){const[s,c]=e;switch(i){case"🌋":t.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!0,lastClicKTick:0,cellType:"lava"};return;case"🐍":t.snakes.push(q([s*n.brickWidth,c*n.brickHeight])),t.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!1,lastClicKTick:0,cellType:"chair"};return;case"🐤":for(var o=0;o<n.chickensPerCell;o++)t.balls.push(j([s*n.brickWidth,c*n.brickHeight]));t.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!1,lastClicKTick:0,cellType:"chair"};return;case"🧱":t.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!0,lastClicKTick:0,cellType:"obstacle"};return;case"🏁":t.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!0,lastClicKTick:0,cellType:"goal"};return;default:t.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!1,lastClicKTick:0,cellType:"chair"};return}}function F(i,e){const t=S(i);return t?t.map(s=>Array.from(s).flatMap(c=>Array(n.levelResolution).fill(c))).flatMap(s=>Array(n.levelResolution).fill(s)).forEach((s,c)=>{s.forEach((o,r)=>{_(o,[r,c],e)})}):e.end="finished",e}function f(i){const[e,t]=i,s=w(i);return[e/s,t/s]}function w(i){const[e,t]=i;return Math.sqrt(e*e+t*t)}function m(i,e){const[t,s]=i;return[t+(Math.random()*2-1)*e,s+(Math.random()*2-1)*e]}function C(i,e){const[t,s]=i;return[t*e,s*e]}function A(i,e){const[t,s]=i,[c,o]=e;return[t+c,s+o]}function H(i,e){const[t,s]=i,[c,o]=e.pos;return t>c-e.width/2&&t<c+e.width/2&&s>o-e.height/2&&s<o+e.height/2}function v(i){const e={paddle:{x:(n.canvasWidth-n.paddleWidth)/2},bricks:I(),score:0,lives:3,balls:[],snakes:[],end:void 0,currentTick:0,placed:[],level:i};return F(i,e)}function I(){let i=[];for(var e=0;e<n.brickColumnCount;e++){i[e]=[];for(var t=0;t<n.brickRowCount;t++){var s=t*(n.brickWidth+n.brickPadding)+n.brickOffsetLeft,c=e*(n.brickHeight+n.brickPadding)+n.brickOffsetTop;let o="obstacle";e==0&&t<5&&(o="goal"),i[e][t]={x:s,y:c,isVisible:!1,lastClicKTick:0,cellType:o}}}return i}function j(i){const[e,t]=i,[s,c]=C(f(m([0,0],1)),n.ballSpeed);return{dx:s,dy:c,x:e,y:t,isVisible:!0}}function q(i){const[e,t]=i,[s,c]=f([2+Math.random(),-2+Math.random()]);return{dx:s,dy:c,x:e,y:t,isVisible:!0}}function G(i){return i.balls.filter(e=>e.isVisible).length==0}var y=(i=>(i.Collide="collide",i.SnakeCollide="snakeBounce",i))(y||{});function L(i,e,t,s){for(var c=0;c<n.brickColumnCount;c++)for(var o=0;o<n.brickRowCount;o++){var r=i.bricks[c][o];if(t.x>r.x-n.ballRadius&&t.x<r.x+n.brickWidth+n.ballRadius&&t.y>r.y-n.ballRadius&&t.y<r.y+n.brickHeight+n.ballRadius&&(r.cellType=="goal"&&!s&&(t.isVisible=!1),r.cellType=="lava"&&!s&&(i.end="lost"),r.isVisible==!0)){const u=r.x+n.brickWidth/2,k=r.y+n.brickHeight/2,[b,g]=m(C(f(A(Q([u,k],i),f([t.x-u,t.y-k]))),n.ballSpeed),.1);t.dx=b,t.dy=g,s?e.play(y.SnakeCollide):e.play(y.Collide)}}}function N(i,e){i.snakes.forEach(t=>{if(!t.isVisible)return;const s=[e.x-t.x,e.y-t.y];w(s)<2*n.ballRadius&&(i.end="lost")})}function J(i,e){e.balls.forEach(t=>{t.isVisible&&(T(t,!1),L(e,i,t,!1),N(e,t),t.x+=t.dx,t.y+=t.dy)})}function T(i,e){(i.x+i.dx>n.canvasWidth-n.ballRadius||i.x+i.dx<n.ballRadius)&&(e?i.dx=-i.dx:i.isVisible=!1),(i.y+i.dy>n.canvasHeight-n.ballRadius||i.y+i.dy<n.ballRadius)&&(e?i.dy=-i.dy:i.isVisible=!1)}function Q(i,e){const[t,s]=i;return e.placed.map(c=>{const o=e.bricks[c.y][c.x],r=[t-o.x,s-o.y];return C(f(r),n.brickRejectForce/w(r))}).reduce(A,[0,0])}function Z(i,e){i.pressed.size==0?e.paddle.x=i.mousePos[0]-n.paddleWidth/2:i.pressed.has("Right")&&e.paddle.x<n.canvasWidth-n.paddleWidth?e.paddle.x+=7:i.pressed.has("Left")&&e.paddle.x>0&&(e.paddle.x-=7)}function $(i,e){i.snakes.forEach(t=>{t.isVisible&&(T(t,!0),L(i,e,t,!0),t.x+=t.dx,t.y+=t.dy)})}function ee(i,e){for(var t=0;t<n.brickColumnCount;t++)for(var s=0;s<n.brickRowCount;s++){if(i.bricks[t][s].isVisible)continue;const c=i.bricks[t][s].x+n.brickWidth/2,o=i.bricks[t][s].y+n.brickHeight/2;if(e.mouseInArea({center:[c,o],width:n.brickWidth,height:n.brickHeight})&&te([c,o],n.brickWidth,n.brickHeight,i)&&e.mouseDown&&i.currentTick>30&&(i.bricks[t][s].isVisible=!0,i.placed.push({y:t,x:s}),i.placed.length>n.maxPlacedObsticales)){const r=i.placed.shift();i.bricks[r.y][r.x].isVisible=!1}}}function te(i,e,t,s){return s.balls.filter(c=>H([c.x,c.y],{pos:i,width:e+n.ballRadius*2,height:t+n.ballRadius*2})).length==0&&s.snakes.filter(c=>H([c.x,c.y],{pos:i,width:e+n.ballRadius*2,height:t+n.ballRadius*2})).length==0}function ie(i,e,t){return t.end?(t.end==="lost"&&i.mouseDown?(console.log("lost"),t=v(t.level)):t.end==="won"&&i.mouseDown&&(console.log("won"),t=v(t.level+1)),t):(t.currentTick++,Z(i,t),J(e,t),$(t,e),ee(t,i),G(t)&&(t.end="won"),t)}class se{constructor(){l(this,"pool",new Map);l(this,"ctx",new AudioContext);l(this,"amountLoaded",0);Object.values(y).map(e=>this.pool.set(e,this.newAudio(e)))}newAudio(e){const t=new Audio;return this.ctx.createMediaElementSource(t).connect(this.ctx.destination),t.src="assets/sounds/"+e+".mp3",t.oncanplay=()=>this.amountLoaded++,t}play(e){this.ctx.state==="suspended"&&this.ctx.resume();const t=this.pool.get(e);t.load(),t.play()}}const ne=document.querySelector("#app"),h=document.createElement("canvas");h.width=n.canvasWidth;h.height=n.canvasHeight;ne.append(h);let x=v(1),d=new B,ce=new se;document.addEventListener("keydown",oe,!1);document.addEventListener("keyup",re,!1);document.addEventListener("mousemove",d.mouseMoveHandler(h),!1);document.addEventListener("mousedown",()=>d.mouseDown=!0);document.addEventListener("mouseup",()=>d.mouseDown=!1);document.addEventListener("click",()=>d.clicked=!0);h.ontouchmove=d.touchMoveHandler(h);h.ontouchstart=()=>d.mouseDown=!0;h.ontouchend=()=>d.mouseDown=!1;function oe(i){d.keyDownHandler(i)}function re(i){d.keyUpHandler(i)}const le=h.getContext("2d");function V(){x=ie(d,ce,x),E(x,le),d.clicked=!1,requestAnimationFrame(V)}V();
