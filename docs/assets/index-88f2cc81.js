var M=Object.defineProperty;var K=(i,e,t)=>e in i?M(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var l=(i,e,t)=>(K(i,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))s(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(c){if(c.ep)return;c.ep=!0;const r=t(c);fetch(c.href,r)}})();const m=700,R=400,y=50,n={canvasWidth:R,canvasHeight:m,paddleHeight:10,paddleWidth:75,ballRadius:20,brickRowCount:Math.floor(R/y),brickColumnCount:Math.floor(m/y),brickWidth:y,brickHeight:y,brickPadding:0,brickOffsetTop:0,brickOffsetLeft:0,chickensPerCell:5,levelResolution:1,maxPlacedObsticales:6,ballSpeed:1.5,brickRejectForce:4};var a=(i=>(i.Snake="snake",i.Brick1="brick1",i.Brick2="brick2",i.Brick3="brick3",i.BrickInvisible="invisble_brick",i.RoundChicken="roundChicken",i.Lava="lava",i.Chair="chair",i))(a||{});class O{constructor(){l(this,"pool",new Map);l(this,"amountLoaded",0);Object.values(a).map(e=>this.pool.set(e,this.newImage(e)))}get(e){return this.pool.get(e)}isLoading(){return this.amountLoaded<this.pool.size}newImage(e){const t=new Image;return t.src="assets/images/"+e+".png",t.onload=()=>this.amountLoaded++,t}}class E{constructor(e){l(this,"imagePool",new O);l(this,"ctx");this.ctx=e}image(e){const[t,s]=e.center;return this.ctx.drawImage(this.imagePool.get(e.source),t-e.width/2,s-e.height/2,e.width,e.height),this}circle(e){const[t,s]=e.center;return this.ctx.beginPath(),this.ctx.arc(t,s,e.radius,0,Math.PI*2),this.ctx.fillStyle=e.color,this.ctx.fill(),this.ctx.closePath(),this}rect(e){const[t,s]=e.center;return this.ctx.beginPath(),this.ctx.rect(t-e.width/2,s-e.height/2,e.width,e.height),this.ctx.fillStyle=e.color,this.ctx.fill(),this.ctx.closePath(),this}text(e,t){return this.textWithArgs({pos:t,value:e})}title(e,t){return this.textWithArgs({pos:t,value:e,size:64,center:!0})}textWithArgs(e){const[t,s]=e.pos,c=e.font??"Arial",r=e.size??16,o=e.color??"#000000",f=e.center??!1;return this.ctx.font=r+"px "+c,this.ctx.fillStyle=o,f&&(this.ctx.textAlign="center"),this.ctx.fillText(e.value,t,s),f&&(this.ctx.textAlign="left"),this}}function B(i,e){for(var t=0;t<n.brickColumnCount;t++)for(var s=0;s<n.brickRowCount;s++){let c=a.BrickInvisible;i.bricks[t][s].isVisible==!0&&(c=a.Brick1),i.bricks[t][s].cellType=="goal"&&(c=a.Brick2),i.bricks[t][s].cellType=="lava"&&(c=a.Lava),i.bricks[t][s].cellType=="chair"&&i.bricks[t][s].isVisible==!0&&(c=a.Chair),e.image({source:c,center:[i.bricks[t][s].x+n.brickWidth/2,i.bricks[t][s].y+n.brickHeight/2],width:n.brickWidth,height:n.brickHeight})}}function X(i,e){e.clearRect(0,0,n.canvasWidth,n.canvasHeight);const t=new E(e);switch(i.end){case"won":t.title("Game Won",[n.canvasWidth/2,n.canvasHeight/2]),t.textWithArgs({value:"Click to Continue",pos:[n.canvasWidth/2,n.canvasHeight/2+50],center:!0});return;case"lost":t.title("Game Lost",[n.canvasWidth/2,n.canvasHeight/2]),t.textWithArgs({value:"Click to Continue",pos:[n.canvasWidth/2,n.canvasHeight/2+50],center:!0});return;case"finished":t.title("Thanks for playing",[n.canvasWidth/2,n.canvasHeight/2]);return}B(i,t),i.placed.length===0&&t.textWithArgs({value:"Click to place",pos:[n.canvasWidth/2,n.canvasHeight-75],size:24,center:!0}),i.snakes.forEach(s=>{s.isVisible&&t.image({source:a.Snake,center:[s.x,s.y],width:n.ballRadius*2,height:n.ballRadius*2})}),i.balls.forEach(s=>{s.isVisible&&t.image({source:a.RoundChicken,center:[s.x,s.y],width:n.ballRadius*2,height:n.ballRadius*2})})}class Y{constructor(){l(this,"pressed");l(this,"mousePos");l(this,"mouseDown");l(this,"clicked");this.pressed=new Set,this.mousePos=[0,0],this.mouseDown=!1,this.clicked=!1}mouseInArea(e){const[t,s]=this.mousePos,[c,r]=e.center,o=c-e.width/2,f=r-e.height/2,p=c+e.width/2,b=r+e.height/2;return o<=t&&t<=p&&f<=s&&s<=b}keyDownHandler(e){console.log(e.code),e.code=="ArrowRight"||e.code=="KeyD"?this.pressed.add("Right"):e.code=="ArrowLeft"||e.code=="KeyA"?this.pressed.add("Left"):e.code=="ArrowUp"||e.code=="KeyW"?this.pressed.add("Up"):(e.code=="ArrowDown"||e.code=="KeyS")&&this.pressed.add("Down")}keyUpHandler(e){e.code=="ArrowRight"||e.code=="KeyD"?this.pressed.delete("Right"):e.code=="ArrowLeft"||e.code=="KeyA"?this.pressed.delete("Left"):e.code=="ArrowUp"||e.code=="KeyW"?this.pressed.delete("Up"):(e.code=="ArrowDown"||e.code=="KeyS")&&this.pressed.delete("Down")}mouseMoveHandler(e){return t=>{var s=t.clientX-e.offsetLeft,c=t.clientY-e.offsetTop;s>0&&s<e.width&&c>0&&c<e.height&&(this.mousePos=[s,c])}}touchMoveHandler(e){return t=>{var s=t.touches[0].clientX-e.offsetLeft,c=t.touches[0].clientY-e.offsetTop;s>0&&s<e.width&&c>0&&c<e.height&&(this.mousePos=[s,c])}}}var h=(i=>(i.Collide="collide",i.SnakeCollide="snakeBounce",i.Win="win",i.Die="die",i.Chicken1="chicken1",i.Chicken2="chicken2",i.Chicken3="chicken3",i))(h||{});function z(i){switch(i){case 1:return U;case 2:return F;case 3:return _;case 4:return I;case 5:return j}return null}const U=["🧱🧱🔲🔲🔲🧱🧱🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🧱🧱🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🐤🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🧱🧱🧱🧱🧱🧱🧱"],_=["🧱🧱🔲🔲🔲🧱🧱🧱","🌋🔲🔲🔲🔲🔲🔲🧱","🌋🔲🔲🔲🔲🔲🔲🧱","🌋🔲🔲🔲🔲🔲🔲🧱","🌋🔲🔲🔲🔲🔲🔲🧱","🌋🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🧱🧱🧱🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🧱🧱🧱🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🐤🔲🔲🔲🔲🔲🌋","🧱🧱🧱🧱🧱🧱🧱🧱"],F=["🧱🧱🔲🔲🔲🧱🧱🧱","🧱🔲🔲🔲🔲🧱🔲🧱","🧱🔲🐍🔲🔲🧱🔲🧱","🧱🔲🔲🔲🔲🧱🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🧱🧱🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🐤🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🧱🧱🧱🧱🧱🧱🧱"],I=["🧱🧱🔲🔲🔲🧱🧱🧱","🧱🔲🔲🔲🔲🧱🔲🧱","🧱🔲🔲🐍🐍🧱🔲🧱","🧱🔲🔲🔲🔲🧱🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🧱🧱🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🐤🔲🔲🧱","🧱🧱🔲🔲🔲🔲🔲🧱","🧱🔲🧱🔲🔲🔲🔲🧱","🧱🐍🔲🔲🧱🔲🔲🧱","🧱🧱🧱🧱🧱🧱🧱🧱"],j=["🧱🧱🔲🔲🔲🧱🧱🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🐍🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🌋🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🔲🔲🔲🔲🧱","🧱🔲🔲🐤🔲🔲🔲🧱","🧱🧱🧱🧱🧱🧱🧱🧱"];function q(i,e,t){const[s,c]=e;switch(i){case"🌋":t.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!0,lastClicKTick:0,cellType:"lava"};return;case"🐍":t.snakes.push(J([s*n.brickWidth,c*n.brickHeight])),t.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!1,lastClicKTick:0,cellType:"chair"};return;case"🐤":for(var r=0;r<n.chickensPerCell;r++)t.balls.push(S([s*n.brickWidth,c*n.brickHeight]));t.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!1,lastClicKTick:0,cellType:"chair"};return;case"🧱":t.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!0,lastClicKTick:0,cellType:"obstacle"};return;case"🏁":t.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!0,lastClicKTick:0,cellType:"goal"};return;default:t.bricks[c][s]={x:s*n.brickWidth,y:c*n.brickHeight,isVisible:!1,lastClicKTick:0,cellType:"chair"};return}}function G(i,e){const t=z(i);return t?t.map(s=>Array.from(s).flatMap(c=>Array(n.levelResolution).fill(c))).flatMap(s=>Array(n.levelResolution).fill(s)).forEach((s,c)=>{s.forEach((r,o)=>{q(r,[o,c],e)})}):e.end="finished",e}function k(i){const[e,t]=i,s=C(i);return[e/s,t/s]}function C(i){const[e,t]=i;return Math.sqrt(e*e+t*t)}function A(i,e){const[t,s]=i;return[t+(Math.random()*2-1)*e,s+(Math.random()*2-1)*e]}function W(i,e){const[t,s]=i;return[t*e,s*e]}function L(i,e){const[t,s]=i,[c,r]=e;return[t+c,s+r]}function H(i,e){const[t,s]=i,[c,r]=e.pos;return t>c-e.width/2&&t<c+e.width/2&&s>r-e.height/2&&s<r+e.height/2}function w(i){const e={paddle:{x:(n.canvasWidth-n.paddleWidth)/2},bricks:N(),score:0,lives:3,balls:[],snakes:[],end:void 0,currentTick:0,placed:[],level:i};return G(i,e)}function N(){let i=[];for(var e=0;e<n.brickColumnCount;e++){i[e]=[];for(var t=0;t<n.brickRowCount;t++){var s=t*(n.brickWidth+n.brickPadding)+n.brickOffsetLeft,c=e*(n.brickHeight+n.brickPadding)+n.brickOffsetTop;let r="obstacle";e==0&&t<5&&(r="goal"),i[e][t]={x:s,y:c,isVisible:!1,lastClicKTick:0,cellType:r}}}return i}function S(i){const[e,t]=i,[s,c]=W(k(A([0,0],1)),n.ballSpeed);return{dx:s,dy:c,x:e,y:t,isVisible:!0}}function J(i){const[e,t]=i,[s,c]=k([2+Math.random(),-2+Math.random()]);return{dx:s,dy:c,x:e,y:t,isVisible:!0}}function Q(i){return i.balls.filter(e=>e.isVisible).length==0}function T(i,e){i.end="lost",e.play(h.Die)}function Z(i,e){console.log("won"),i.end="won",e.play(h.Win)}function g(i,e,t,s){for(var c=0;c<n.brickColumnCount;c++)for(var r=0;r<n.brickRowCount;r++){var o=i.bricks[c][r];if(t.x>o.x-n.ballRadius&&t.x<o.x+n.brickWidth+n.ballRadius&&t.y>o.y-n.ballRadius&&t.y<o.y+n.brickHeight+n.ballRadius&&(o.cellType=="goal"&&!s&&(t.isVisible=!1),o.cellType=="lava"&&!s&&T(i,e),o.isVisible==!0)){const f=o.x+n.brickWidth/2,p=o.y+n.brickHeight/2,[b,D]=A(W(k(L(te([f,p],i),k([t.x-f,t.y-p]))),n.ballSpeed),.1);if(t.dx=b,t.dy=D,s)e.play(h.SnakeCollide);else{const x=Math.random();x<.4?e.play(h.Collide):x<.6?e.play(h.Chicken1):x<.8?e.play(h.Chicken2):e.play(h.Chicken3)}}}}function $(i,e,t){i.snakes.forEach(s=>{if(!s.isVisible)return;const c=[e.x-s.x,e.y-s.y];C(c)<2*n.ballRadius&&T(i,t)})}function ee(i,e){e.balls.forEach(t=>{t.isVisible&&(V(t,!1),g(e,i,t,!1),$(e,t,i),t.x+=t.dx,t.y+=t.dy)})}function V(i,e){(i.x+i.dx>n.canvasWidth-n.ballRadius||i.x+i.dx<n.ballRadius)&&(e?i.dx=-i.dx:i.isVisible=!1),(i.y+i.dy>n.canvasHeight-n.ballRadius||i.y+i.dy<n.ballRadius)&&(e?i.dy=-i.dy:i.isVisible=!1)}function te(i,e){const[t,s]=i;return e.placed.map(c=>{const r=e.bricks[c.y][c.x],o=[t-r.x,s-r.y];return W(k(o),n.brickRejectForce/C(o))}).reduce(L,[0,0])}function ie(i,e){i.pressed.size==0?e.paddle.x=i.mousePos[0]-n.paddleWidth/2:i.pressed.has("Right")&&e.paddle.x<n.canvasWidth-n.paddleWidth?e.paddle.x+=7:i.pressed.has("Left")&&e.paddle.x>0&&(e.paddle.x-=7)}function se(i,e){i.snakes.forEach(t=>{t.isVisible&&(V(t,!0),g(i,e,t,!0),t.x+=t.dx,t.y+=t.dy)})}function ne(i,e){for(var t=0;t<n.brickColumnCount;t++)for(var s=0;s<n.brickRowCount;s++){if(i.bricks[t][s].isVisible)continue;const c=i.bricks[t][s].x+n.brickWidth/2,r=i.bricks[t][s].y+n.brickHeight/2;if(e.mouseInArea({center:[c,r],width:n.brickWidth,height:n.brickHeight})&&ce([c,r],n.brickWidth,n.brickHeight,i)&&e.mouseDown&&i.currentTick>30&&(i.bricks[t][s].isVisible=!0,i.placed.push({y:t,x:s}),i.placed.length>n.maxPlacedObsticales)){const o=i.placed.shift();i.bricks[o.y][o.x].isVisible=!1}}}function ce(i,e,t,s){return s.balls.filter(c=>H([c.x,c.y],{pos:i,width:e+n.ballRadius*2,height:t+n.ballRadius*2})).length==0&&s.snakes.filter(c=>H([c.x,c.y],{pos:i,width:e+n.ballRadius*2,height:t+n.ballRadius*2})).length==0}function re(i,e,t){return t.end?(t.end==="lost"&&i.mouseDown?t=w(t.level):t.end==="won"&&i.mouseDown&&(t=w(t.level+1)),t):(t.currentTick++,ie(i,t),ee(e,t),se(t,e),ne(t,i),Q(t)&&Z(t,e),t)}class oe{constructor(){l(this,"pool",new Map);l(this,"ctx",new AudioContext);l(this,"amountLoaded",0);Object.values(h).map(e=>this.pool.set(e,this.newAudio(e)))}newAudio(e){const t=new Audio;return this.ctx.createMediaElementSource(t).connect(this.ctx.destination),t.src="assets/sounds/"+e+".mp3",t.oncanplay=()=>this.amountLoaded++,t}play(e){this.ctx.state==="suspended"&&this.ctx.resume();const t=this.pool.get(e);t.load(),t.play()}}const le=document.querySelector("#app"),u=document.createElement("canvas");u.width=n.canvasWidth;u.height=n.canvasHeight;le.append(u);let v=w(1),d=new Y,de=new oe;document.addEventListener("keydown",ae,!1);document.addEventListener("keyup",he,!1);document.addEventListener("mousemove",d.mouseMoveHandler(u),!1);document.addEventListener("mousedown",()=>d.mouseDown=!0);document.addEventListener("mouseup",()=>d.mouseDown=!1);document.addEventListener("click",()=>d.clicked=!0);u.ontouchmove=d.touchMoveHandler(u);u.ontouchstart=()=>d.mouseDown=!0;u.ontouchend=()=>d.mouseDown=!1;function ae(i){d.keyDownHandler(i)}function he(i){d.keyUpHandler(i)}const ue=u.getContext("2d");function P(){v=re(d,de,v),X(v,ue),d.clicked=!1,requestAnimationFrame(P)}P();
